# Brief for "AI-Guided Journaling — Obsidian Plugin" (MVP)

### Purpose

• Help users produce a daily journal template generated by a Large-Language-Model (LLM) while allowing them to curate "memory" prompt fragments (templates) stored as normal Markdown files inside the vault.
• Keep the first release lightweight, local-only, and configurable through a short settings panel.

### Core Features  

F1. Memory Directory  
 • A user-selectable folder inside the vault that holds Markdown files (templates/rules).  
 • Each file is treated as plain text that can be concatenated to build the system prompt for the LLM.

F2. Daily Journal Generation  
 • Provides a command "Append AI Journal Template".
 • When the command is run:
   a. It checks if the current note is today's daily note (using Daily Notes plugin settings).
   b. If not a daily note, shows a notice that this only works with daily notes.
   c. It then performs the generation:
      i. Shows an elegant loading indicator.
      ii. Reads every Markdown file in the configured memory directory (sorted alphabetically).
      iii. Assembles a prompt that contains those memories plus context about today's date.
      iv. Sends the prompt to the configured LLM endpoint.
      v. Appends the generated template to the current daily note with a separator.
 • When a daily note is opened or created, a ribbon icon appears that runs the "Append AI Journal Template" command.
 • The ribbon icon remains visible to allow multiple template generations per day.

   F3. Settings Panel  
 • OpenAPI Base URL (string, required).  
 • API Key / Auth Token (string, stored using Obsidian's secure storage).  
 • Memory Directory (vault-relative path; folder picker).  
 • Test Connection button (verifies the endpoint and API key by sending a minimal chat completion request).  
 • Reset to Defaults button.

   F4. Minimal Error Feedback  
 • All network, authentication, and parsing errors surface through Obsidian notices with concise messages and a "Show Logs" link (opens console log).

### Non-Functional Requirements  

• Local-only settings: no cloud sync of API keys by default; keys live in `.obsidian/plugins/ai-guided-journaling/data.json`.  
• No third-party analytics or telemetry.  
• Must operate offline (gracefully fails if endpoint unreachable).
• Complies with Obsidian's community-plugin policy (no unsafe eval).

### Configuration & Data Model  

Settings schema (JSON):  

```json
{
  "apiBaseUrl": "https://example.com/v1/chat/completions",
  "apiKey": "",
  "memoryDir": "Journal Memories"
}
```  

Runtime state:  
• settings → reactive object.  
• memoryCache → string (concatenated file contents, cached until vault changes).

### User Flow  

1. User installs plugin, opens Settings → "AI-Guided Journaling".  
2. Enters API URL & key, selects memory directory (plugin offers to create it).  
3. Adds or edits Markdown files inside that directory (e.g., "gratitude.md", "reflection.md").  
4. Opens Obsidian Daily Note.
5. "Append AI-generated template" appears.
6. User clicks the ribbon icon, sees a loader, and then the generated template appears in the note.
7. Writes a journal by filling out the template.

### Security & Privacy  

• API key is stored in the plugin's settings file (`data.json`). While not encrypted, it is stored in the vault's private `.obsidian` directory, which is standard practice for Obsidian plugins.
• No logging of prompt or LLM response beyond Obsidian console (developer opt-in).  
• Respect vault file-access sandbox; never read outside chosen directory.
